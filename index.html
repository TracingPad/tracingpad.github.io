<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- START SEO OPTIMIZATION -->
    <title>Digital Tracing Pad | Practice Alphabets (Hindi, Telugu, English, Tamil)</title>
    
    <!-- NEW FAVICON: Set to use the "✍️" emoji via embedded SVG -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext x='50%25' y='90%25' style='font-size:80px; text-anchor:middle;'%3E%E2%9C%8D%EF%B8%8F%3C/text%3E%3C/svg%3E">

    <!-- Meta Description: A concise summary for search results -->
    <meta name="description" content="Practice tracing the complete Hindi, Telugu, English, and Tamil Alphabets on a realistic digital slate. Free and interactive learning tool.">
    
    <!-- Keywords (Optional, but helpful) -->
    <meta name="keywords" content="Hindi alphabet tracing, Telugu alphabet tracing, English alphabet tracing, Tamil alphabet tracing, Hindi Varnamala, Learn letters, multilingual tracing">
    
    <!-- Open Graph Tags for Social Media Sharing - Updated Title -->
    <meta property="og:title" content="Tracing Pad: Practice Hindi, Telugu, English, and Tamil Alphabets">
    <meta property="og:description" content="Practice tracing Hindi, Telugu, English, and Tamil characters for free on this fun, digital blackboard. Perfect for beginners!">
    <meta property="og:type" content="website">
    <!-- END SEO OPTIMIZATION -->
    
    <!-- Google Analytics Gtag Snippet -->
    <!-- ID: G-8SDCCCH29Q -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-8SDCCCH29Q"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-8SDCCCH29Q'); 
    </script>

    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Configure Tailwind to use Inter font -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        
        /* General body and theme styling */
        body {
            font-family: 'Inter', sans-serif;
            /* Realistic wood gradient background */
            background: linear-gradient(180deg, #965b38 0%, #7d4825 50%, #683818 100%);
            padding: 0; 
            margin: 0;
            display: flex; 
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
        }
        
        /* Slate Board Container */
        #canvas-container {
            width: 98vw; 
            max-width: 92vw; 
            max-height: 82vh; 
            margin-bottom: 2rem;
            aspect-ratio: 1.2 / 1; 
            background-color: #2d3a3a; 
            border: none;
            border-radius: 1.5rem; 
            position: relative;
            overflow: hidden;
        }

        /* Character Guide Text */
        #tracing-guide {
            position: absolute;
            top: 55%; 
            left: 50%;
            transform: translate(-50%, -50%); 
            font-size: 30vw; /* Default size for regional scripts */
            max-width: 90%;
            text-align: center;
            line-height: 1;
            font-weight: 900;
            color: rgba(255, 255, 255, 0.1); 
            user-select: none;
            pointer-events: none;
        }
        
        /* Adjust guide font size for English (A-Z) to prevent overflow */
        .lang-english #tracing-guide {
             font-size: 25vw; 
        }

        /* Ensure canvas fills the container */
        #tracingCanvas {
            width: 100%;
            height: 100%;
        }
    </style>
</head>
<body class="flex flex-col items-center justify-center">

    <!-- Character Selector Modal (Stays fixed to the entire viewport) -->
    <div id="character-selector-modal" class="fixed inset-0 bg-gray-900/90 z-50 hidden flex items-center justify-center p-4">
        <div class="bg-white p-6 rounded-xl shadow-2xl w-full max-w-xl">
            <div class="flex justify-between items-center mb-4">
                <h3 id="modal-title" class="text-2xl font-bold text-gray-800">Select Character</h3>
                <button id="closeModalBtn" class="text-gray-500 hover:text-gray-800 text-3xl font-light leading-none">&times;</button>
            </div>
            <div id="character-grid" class="grid grid-cols-6 sm:grid-cols-8 gap-3 max-h-[70vh] overflow-y-auto p-2">
                <!-- Characters will be dynamically inserted here -->
            </div>
            <p class="mt-4 text-sm text-gray-600 text-center">Click a character to start tracing.</p>
        </div>
    </div>
    
    <!-- Top Bar: Title and External Links -->
    <div class="w-full max-w-[92vw] mx-auto mb-4 px-4 flex justify-center items-center relative"> 
        
        <!-- Suggestions Link (Left) -->
        <a 
            href="#" 
            id="suggestionsLink"
            target="_blank" 
            class="absolute left-4 inline-flex items-center space-x-2 px-3 py-1 text-sm bg-indigo-200 text-gray-800 font-bold rounded-full shadow-lg hover:bg-indigo-100 transition transform hover:scale-105" 
            title="Suggest Features or Report Bugs"
        >
            <span>Suggestions 💡</span>
        </a>

        <!-- Main Title (Centered) -->
        <h1 class="text-2xl sm:text-3xl font-extrabold text-white/90 drop-shadow-lg user-select-none pointer-events-none">Tracing Pad</h1> 
        
        <!-- Buy Me A Coffee Link (Right) -->
        <a href="https://www.buymeacoffee.com/saigandikota" 
            id="buyMeACoffeeLink"
            target="_blank" 
            class="absolute right-4 inline-flex items-center space-x-2 px-3 py-1 text-sm bg-yellow-400 text-gray-900 font-bold rounded-full shadow-lg hover:bg-yellow-300 transition transform hover:scale-105">
            <span>Buy me a Coffee ☕</span>
        </a>
    </div>

    <!-- Language Selector Buttons -->
    <div class="flex justify-center space-x-2 mb-4">
        <button id="langTeluguBtn" data-lang="Telugu" class="lang-btn px-4 py-2 text-sm font-semibold rounded-full shadow-md transition">Telugu</button>
        <button id="langHindiBtn" data-lang="Hindi" class="lang-btn px-4 py-2 text-sm font-semibold rounded-full shadow-md transition">Hindi</button>
        <button id="langEnglishBtn" data-lang="English" class="lang-btn px-4 py-2 text-sm font-semibold rounded-full shadow-md transition">English</button>
        <button id="langTamilBtn" data-lang="Tamil" class="lang-btn px-4 py-2 text-sm font-semibold rounded-full shadow-md transition">Tamil</button>
    </div>

    <!-- Canvas Area (The Slate) -->
    <div id="canvas-container">
        
        <!-- Header Content (Subtitle and Category Buttons) -->
        <div id="slate-header-content" class="absolute top-0 left-1/2 transform -translate-x-1/2 text-center text-white/90 w-full z-20 px-8 pt-5 pb-3">
            
            <!-- Dynamic Subtitle -->
            <div class="user-select-none pointer-events-none mb-3">
                <p id="subtitle-text" class="text-base sm:text-lg font-medium opacity-80"></p>
            </div>
            
            <!-- Dynamic Category buttons container -->
            <div id="category-buttons-container" class="flex justify-center space-x-3 mb-3">
                <!-- Buttons populated dynamically -->
            </div>
        </div>
        
        <!-- Clear Button -->
        <button id="clearBtn" class="absolute top-6 right-6 p-2 bg-red-600 text-white rounded-full shadow-xl hover:bg-red-700 transition z-30" title="Clear Slate (Reset)">
            <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-rotate-ccw">
                <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-3.26 1.17l-1.39 1.18"/>
                <path d="M2 13v-3h3"/>
            </svg>
        </button>

        <!-- Navigation Arrows -->
        <button id="prevBtn" class="absolute left-2 top-1/2 transform -translate-y-1/2 p-3 bg-blue-600 text-white rounded-full shadow-xl hover:bg-blue-700 transition disabled:opacity-50 z-20">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" classide lucide-arrow-left"><path d="m12 19-7-7 7-7"/><path d="M19 12H5"/></svg>
        </button>
        <button id="nextBtn" class="absolute right-2 top-1/2 transform -translate-y-1/2 p-3 bg-blue-600 text-white rounded-full shadow-xl hover:bg-blue-700 transition disabled:opacity-50 z-20">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-arrow-right"><path d="M5 12h14"/><path d="m12 5 7 7-7 7"/></svg>
        </button>
        
        <!-- Faint character guide -->
        <div id="tracing-guide"></div>

        <!-- Pronunciation Text Container -->
        <div id="pronunciation-container" class="absolute bottom-4 left-1/2 transform -translate-x-1/2 z-10 flex items-center space-x-2">
            <div id="pronunciation-text" class="text-sm sm:text-lg font-medium text-white/80 user-select-none pointer-events-none whitespace-nowrap">
                Pronunciation: 
            </div>
        </div>

        <canvas id="tracingCanvas"></canvas>
    </div>

    <script>
        // --- Cookie Utility Functions for Language Persistence ---
        
        /**
         * Sets a cookie with a name, value, and expiration in days.
         * @param {string} name - The name of the cookie.
         * @param {string} value - The value to store.
         * @param {number} days - Number of days until the cookie expires.
         */
        function setCookie(name, value, days) {
            const date = new Date();
            date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
            const expires = "expires=" + date.toUTCString();
            document.cookie = name + "=" + value + ";" + expires + ";path=/";
        }

        /**
         * Gets the value of a cookie by name.
         * @param {string} name - The name of the cookie.
         * @returns {string | null} The cookie value or null if not found.
         */
        function getCookie(name) {
            const nameEQ = name + "=";
            const ca = document.cookie.split(';');
            for (let i = 0; i < ca.length; i++) {
                let c = ca[i];
                while (c.charAt(0) === ' ') c = c.substring(1, c.length);
                if (c.indexOf(nameEQ) === 0) return c.substring(nameEQ.length, c.length);
            }
            return null;
        }

        // Helper function to send custom events to GA
        function trackEvent(eventName, eventParams = {}) {
            try {
                if (typeof gtag === 'function') {
                    gtag('event', eventName, eventParams);
                }
            } catch (e) {
                console.error("Error tracking GA event:", e);
            }
        }

        // --- Configuration and State ---
        const SLATE_BACKGROUND_COLOR = '#2d3a3a'; 
        const DEFAULT_CHALK_COLOR = '#ffffff'; 
        let currentBrushSize = 20; 
        
        // Default is English, but will be overwritten by cookie if present
        let currentLanguage = 'English'; 
        let currentCharacterIndex = 0;
        let isDrawing = false;
        
        // --- Character Data Definitions ---
        
        // 1. Telugu Data
        const TELUGU_VOWELS = [
            { char: 'అ', pron: 'a (as in am)', category: 'achulu' }, { char: 'ఆ', pron: 'aa (as in arm)', category: 'achulu' },
            { char: 'ఇ', pron: 'i (as in it)', category: 'achulu' }, { char: 'ఈ', pron: 'ee (as in eat)', category: 'achulu' },
            { char: 'ఉ', pron: 'u (as in put)', category: 'achulu' }, { char: 'ఊ', pron: 'oo (as in shoot)', category: 'achulu' },
            { char: 'ఋ', pron: 'ru (vocalic r)', category: 'achulu' }, { char: 'ౠ', pron: 'ruu (long vocalic r)', category: 'achulu' },
            { char: 'ఎ', pron: 'e (as in hen)', category: 'achulu' }, { char: 'ఏ', pron: 'E (as in hail)', category: 'achulu' },
            { char: 'ఐ', pron: 'ai (as in aisle)', category: 'achulu' }, { char: 'ఒ', pron: 'o (as in open)', category: 'achulu' },
            { char: 'ఓ', pron: 'O (as in boat)', category: 'achulu' }, { char: 'ఔ', pron: 'au (as in owl)', category: 'achulu' },
            { char: 'అం', pron: 'am (Anuswara)', category: 'achulu' }, { char: 'అః', pron: 'aha (Visarga)', category: 'achulu' },
        ];
        const TELUGU_CONSONANTS = [
            { char: 'క', pron: 'ka (as in kite)', category: 'hallulu' }, { char: 'ఖ', pron: 'kha (aspirated k)', category: 'hallulu' },
            { char: 'గ', pron: 'ga (as in gate)', category: 'hallulu' }, { char: 'ఘ', pron: 'gha (aspirated g)', category: 'hallulu' },
            { char: 'ఙ', pron: 'nga (as in sing)', category: 'hallulu' }, { char: 'చ', pron: 'cha (as in chair)', category: 'hallulu' },
            { char: 'ఛ', pron: 'chha (aspirated ch)', category: 'hallulu' }, { char: 'జ', pron: 'ja (as in joy)', category: 'hallulu' },
            { char: 'ఝ', pron: 'jha (aspirated j)', category: 'hallulu' }, { char: 'ఞ', pron: 'nya (as in canyon)', category: 'hallulu' },
            { char: 'ట', pron: 'ta (retroflex t)', category: 'hallulu' }, { char: 'ఠ', pron: 'tha (aspirated retroflex t)', category: 'hallulu' },
            { char: 'డ', pron: 'da (retroflex d)', category: 'hallulu' }, { char: 'ఢ', pron: 'dha (aspirated retroflex d)', category: 'hallulu' },
            { char: 'ణ', pron: 'na (retroflex n)', category: 'hallulu' }, { char: 'త', pron: 'tha (dental t)', category: 'hallulu' },
            { char: 'థ', pron: 'thha (aspirated dental t)', category: 'hallulu' }, { char: 'ద', pron: 'dha (dental d)', category: 'hallulu' },
            { char: 'ధ', pron: 'dhha (aspirated dental d)', category: 'hallulu' }, { char: 'న', pron: 'na (dental n)', category: 'hallulu' },
            { char: 'ప', pron: 'pa (as in pot)', category: 'hallulu' }, { char: 'ఫ', pron: 'pha (aspirated p)', category: 'hallulu' },
            { char: 'బ', pron: 'ba (as in bat)', category: 'hallulu' }, { char: 'భ', pron: 'bha (aspirated b)', category: 'hallulu' },
            { char: 'మ', pron: 'ma (as in mat)', category: 'hallulu' }, { char: 'య', pron: 'ya (as in yes)', category: 'hallulu' },
            { char: 'ర', pron: 'ra (soft r)', category: 'hallulu' }, { char: 'ల', pron: 'la (as in lip)', category: 'hallulu' },
            { char: 'వ', pron: 'va (as in van)', category: 'hallulu' }, { char: 'శ', pron: 'sha (palatal s)', category: 'hallulu' },
            { char: 'ష', pron: 'Sha (retroflex s)', category: 'hallulu' }, { char: 'స', pron: 'sa (as in sun)', category: 'hallulu' },
            { char: 'హ', pron: 'ha (as in hat)', category: 'hallulu' }, { char: 'ళ', pron: 'la (retroflex l)', category: 'hallulu' },
            { char: 'క్ష', pron: 'ksha (ks+h)', category: 'hallulu' }, { char: 'ఱ', pron: 'ra (trilled r)', category: 'hallulu' },
        ];
        const TELUGU_CHARACTERS = [...TELUGU_VOWELS, ...TELUGU_CONSONANTS];

        // 2. English Data
        const ENGLISH_UPPERCASE = Array.from({ length: 26 }, (_, i) => {
            const char = String.fromCharCode(65 + i);
            return { char, pron: `${char}`, category: 'uppercase' };
        });
        const ENGLISH_LOWERCASE = Array.from({ length: 26 }, (_, i) => {
            const char = String.fromCharCode(97 + i);
            return { char, pron: char, category: 'lowercase' };
        });
        const ENGLISH_CHARACTERS = [...ENGLISH_UPPERCASE, ...ENGLISH_LOWERCASE];
        
        // 3. Tamil Data
        const TAMIL_VOWELS = [
            { char: 'அ', pron: 'a (as in fun)', category: 'uyir' }, { char: 'ஆ', pron: 'aa (as in father)', category: 'uyir' },
            { char: 'இ', pron: 'i (as in in)', category: 'uyir' }, { char: 'ஈ', pron: 'ee (as in feet)', category: 'uyir' },
            { char: 'உ', pron: 'u (as in put)', category: 'uyir' }, { char: 'ஊ', pron: 'oo (as in boot)', category: 'uyir' },
            { char: 'எ', pron: 'e (as in pet)', category: 'uyir' }, { char: 'ஏ', pron: 'E (as in day)', category: 'uyir' },
            { char: 'ஐ', pron: 'ai (as in eye)', category: 'uyir' }, { char: 'ஒ', pron: 'o (as in orb)', category: 'uyir' },
            { char: 'ஓ', pron: 'O (as in boat)', category: 'uyir' }, { char: 'ஔ', pron: 'au (as in cow)', category: 'uyir' },
        ];
        const TAMIL_CONSONANTS = [
            { char: 'க்', pron: 'ik (hard k)', category: 'mei' }, { char: 'ங்', pron: 'ing (as in sing)', category: 'mei' },
            { char: 'ச்', pron: 'ich (soft ch)', category: 'mei' }, { char: 'ஞ்', pron: 'inj (as in canyon)', category: 'mei' },
            { char: 'ட்', pron: 'it (retroflex t)', category: 'mei' }, { char: 'ண்', pron: 'in (retroflex n)', category: 'mei' },
            { char: 'த்', pron: 'ith (dental t)', category: 'mei' }, { char: 'ந்', pron: 'inth (dental n)', category: 'mei' },
            { char: 'ப்', pron: 'ip (as in pen)', category: 'mei' }, { char: 'ம்', pron: 'im (as in man)', category: 'mei' },
            { char: 'ய்', pron: 'iy (as in yes)', category: 'mei' }, { char: 'ர்', pron: 'ir (trilled r)', category: 'mei' },
            { char: 'ல்', pron: 'il (light l)', category: 'mei' }, { char: 'வ்', pron: 'iv (as in van)', category: 'mei' },
            { char: 'ழ்', pron: 'izh (retroflex l)', category: 'mei' }, { char: 'ள்', pron: 'il (retroflex l)', category: 'mei' },
            { char: 'ற்', pron: 'irr (trilled rr)', category: 'mei' }, { char: 'ன்', pron: 'inn (dental n)', category: 'mei' },
        ];
        const TAMIL_CHARACTERS = [...TAMIL_VOWELS, ...TAMIL_CONSONANTS];

        // 4. Hindi Data (New!)
        const HINDI_VOWELS = [
            { char: 'अ', pron: 'a (as in but)', category: 'swar' }, { char: 'आ', pron: 'aa (as in car)', category: 'swar' },
            { char: 'इ', pron: 'i (as in pin)', category: 'swar' }, { char: 'ई', pron: 'ee (as in beet)', category: 'swar' },
            { char: 'उ', pron: 'u (as in put)', category: 'swar' }, { char: 'ऊ', pron: 'oo (as in boot)', category: 'swar' },
            { char: 'ऋ', pron: 'ri (vocalic r)', category: 'swar' }, 
            { char: 'ए', pron: 'e (as in bait)', category: 'swar' }, { char: 'ऐ', pron: 'ai (as in side)', category: 'swar' },
            { char: 'ओ', pron: 'o (as in boat)', category: 'swar' }, { char: 'औ', pron: 'au (as in loud)', category: 'swar' },
            { char: 'अं', pron: 'am (Anuswar)', category: 'swar' }, { char: 'अः', pron: 'ah (Visarg)', category: 'swar' },
        ];
        const HINDI_CONSONANTS = [
            { char: 'क', pron: 'ka (unvoiced, unaspirated)', category: 'vyanjan' }, { char: 'ख', pron: 'kha (unvoiced, aspirated)', category: 'vyanjan' },
            { char: 'ग', pron: 'ga (voiced, unaspirated)', category: 'vyanjan' }, { char: 'घ', pron: 'gha (voiced, aspirated)', category: 'vyanjan' },
            { char: 'ङ', pron: 'nga (velar nasal)', category: 'vyanjan' }, { char: 'च', pron: 'cha (unvoiced, unaspirated)', category: 'vyanjan' },
            { char: 'छ', pron: 'chha (unvoiced, aspirated)', category: 'vyanjan' }, { char: 'ज', pron: 'ja (voiced, unaspirated)', category: 'vyanjan' },
            { char: 'झ', pron: 'jha (voiced, aspirated)', category: 'vyanjan' }, { char: 'ञ', pron: 'nya (palatal nasal)', category: 'vyanjan' },
            { char: 'ट', pron: 'ta (retroflex, unaspirated)', category: 'vyanjan' }, { char: 'ठ', pron: 'tha (retroflex, aspirated)', category: 'vyanjan' },
            { char: 'ड', pron: 'da (retroflex, unaspirated)', category: 'vyanjan' }, { char: 'ढ', pron: 'dha (retroflex, aspirated)', category: 'vyanjan' },
            { char: 'ण', pron: 'na (retroflex nasal)', category: 'vyanjan' }, { char: 'त', pron: 'ta (dental, unaspirated)', category: 'vyanjan' },
            { char: 'थ', pron: 'tha (dental, aspirated)', category: 'vyanjan' }, { char: 'द', pron: 'da (dental, unaspirated)', category: 'vyanjan' },
            { char: 'ध', pron: 'dha (dental, aspirated)', category: 'vyanjan' }, { char: 'न', pron: 'na (dental nasal)', category: 'vyanjan' },
            { char: 'प', pron: 'pa (as in pin)', category: 'vyanjan' }, { char: 'फ', pron: 'pha (aspirated p)', category: 'vyanjan' },
            { char: 'ब', pron: 'ba (as in bat)', category: 'vyanjan' }, { char: 'भ', pron: 'bha (aspirated b)', category: 'vyanjan' },
            { char: 'म', pron: 'ma (as in man)', category: 'vyanjan' }, { char: 'य', pron: 'ya (as in yes)', category: 'vyanjan' },
            { char: 'र', pron: 'ra (as in run)', category: 'vyanjan' }, { char: 'ल', pron: 'la (as in lap)', category: 'vyanjan' },
            { char: 'व', pron: 'va/wa (as in van)', category: 'vyanjan' }, { char: 'श', pron: 'sha (palatal s)', category: 'vyanjan' },
            { char: 'ष', pron: 'sha (retroflex s)', category: 'vyanjan' }, { char: 'स', pron: 'sa (as in sun)', category: 'vyanjan' },
            { char: 'ह', pron: 'ha (as in hat)', category: 'vyanjan' },
            { char: 'क्ष', pron: 'ksha (compound)', category: 'vyanjan' }, { char: 'त्र', pron: 'tra (compound)', category: 'vyanjan' },
            { char: 'ज्ञ', pron: 'gya (compound)', category: 'vyanjan' },
        ];
        const HINDI_CHARACTERS = [...HINDI_VOWELS, ...HINDI_CONSONANTS];
        
        // 5. Language Configuration Map (Updated)
        const LANGUAGES = {
            Telugu: {
                subtitle: "Practice Telugu Alphabet (అక్షరమాల)",
                characters: TELUGU_CHARACTERS,
                categories: [
                    { id: 'achulu', label: 'అచ్చులు - Achulu', chars: TELUGU_VOWELS },
                    { id: 'hallulu', label: 'హల్లులు - Hallulu', chars: TELUGU_CONSONANTS }
                ]
            },
            Hindi: {
                subtitle: "Practice Hindi Alphabet (वर्णमाला - Varnamala)",
                characters: HINDI_CHARACTERS,
                categories: [
                    { id: 'swar', label: 'स्वर - Swar (Vowels)', chars: HINDI_VOWELS },
                    { id: 'vyanjan', label: 'व्यंजन - Vyanjan (Consonants)', chars: HINDI_CONSONANTS }
                ]
            },
            English: {
                subtitle: "Practice English Alphabet (A-Z, a-z)",
                characters: ENGLISH_CHARACTERS,
                categories: [
                    { id: 'uppercase', label: 'Uppercase (A-Z)', chars: ENGLISH_UPPERCASE },
                    { id: 'lowercase', label: 'Lowercase (a-z)', chars: ENGLISH_LOWERCASE }
                ]
            },
            Tamil: { 
                subtitle: "Practice Tamil Alphabet (தமிழ் எழுத்துக்கள்)",
                characters: TAMIL_CHARACTERS,
                categories: [
                    { id: 'uyir', label: 'உயிர் - Uyir Ezhuthu (Vowels)', chars: TAMIL_VOWELS },
                    { id: 'mei', label: 'மெய் - Mei Ezhuthu (Consonants)', chars: TAMIL_CONSONANTS }
                ]
            }
        };

        // --- DOM Elements ---
        const canvas = document.getElementById('tracingCanvas');
        const ctx = canvas.getContext('2d');
        const guideDiv = document.getElementById('tracing-guide');
        const pronunciationTextDisplay = document.getElementById('pronunciation-text'); 
        const subtitleText = document.getElementById('subtitle-text');
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const clearBtn = document.getElementById('clearBtn'); 
        const canvasContainer = document.getElementById('canvas-container');
        const categoryButtonsContainer = document.getElementById('category-buttons-container');
        
        // Modal Elements
        const modal = document.getElementById('character-selector-modal');
        const modalTitle = document.getElementById('modal-title');
        const charGrid = document.getElementById('character-grid');
        const closeModalBtn = document.getElementById('closeModalBtn');
        
        // Language Buttons
        const langBtns = document.querySelectorAll('.lang-btn');
        const body = document.body;


        // --- Core Application Logic ---

        /**
         * Clears the canvas entirely (the "Reset" function).
         */
        function clearCanvas() {
            ctx.fillStyle = SLATE_BACKGROUND_COLOR;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Track the clear action
            const currentChar = LANGUAGES[currentLanguage].characters[currentCharacterIndex];
            trackEvent('slate_cleared', {
                language: currentLanguage.toLowerCase(),
                character: currentChar.char,
                category: currentChar.category
            });
        }

        /**
         * Updates the displayed character, subtitle, and navigation buttons.
         */
        function updateCharacterDisplay() {
            const charList = LANGUAGES[currentLanguage].characters;
            const charData = charList[currentCharacterIndex];
            
            // Update guide text and pronunciation
            guideDiv.textContent = charData.char;
            pronunciationTextDisplay.textContent = `Pronunciation: ${charData.pron}`;
            subtitleText.textContent = LANGUAGES[currentLanguage].subtitle;
            
            // Update button states
            prevBtn.disabled = currentCharacterIndex === 0;
            nextBtn.disabled = currentCharacterIndex === charList.length - 1;
        }
        
        /**
         * Switches the active language, updates state, and saves the selection to a cookie.
         * @param {string} lang - 'Telugu', 'English', 'Tamil', or 'Hindi'.
         */
        function switchLanguage(lang) {
            // Only switch if the language is valid and different
            if (!LANGUAGES[lang] || currentLanguage === lang) return;

            currentLanguage = lang;
            currentCharacterIndex = 0; // Reset index to the start of the new language set
            
            // Save the new language selection to a cookie for 365 days
            setCookie('tracingPadLang', lang, 365);

            // Update language selector button styles and body class
            langBtns.forEach(btn => {
                const isActive = btn.dataset.lang === lang;
                
                // Toggle active class on button
                if (isActive) {
                    btn.className = 'lang-btn px-4 py-2 text-sm font-semibold rounded-full shadow-md transition bg-blue-600 text-white';
                } else {
                    btn.className = 'lang-btn px-4 py-2 text-sm font-semibold rounded-full shadow-md transition bg-gray-200 text-gray-800 hover:bg-gray-300';
                }
            });
            
            // Fix: Directly control the body class for the English styling variant
            body.classList.remove('lang-english');
            if (lang === 'English') {
                body.classList.add('lang-english');
            }


            // Update UI
            updateCategoryButtons(); // Renders the category buttons for the selected language
            clearCanvas();
            updateCharacterDisplay();

            trackEvent('language_switch', {
                new_language: lang.toLowerCase()
            });
        }

        /**
         * Dynamically creates the category buttons based on the current language.
         */
        function updateCategoryButtons() {
            categoryButtonsContainer.innerHTML = '';
            const categories = LANGUAGES[currentLanguage].categories;

            categories.forEach(category => {
                const button = document.createElement('button');
                button.className = 'px-3 py-1 text-sm bg-indigo-600 text-white font-semibold rounded-full shadow-lg hover:bg-indigo-700 transition whitespace-nowrap';
                button.textContent = category.label;
                button.dataset.categoryId = category.id;

                button.addEventListener('click', () => {
                    openSelectorModal(category.id);
                });
                categoryButtonsContainer.appendChild(button);
            });
        }

        // --- Drawing and Canvas Helpers ---
        
        function setDrawingStyle() {
            ctx.strokeStyle = DEFAULT_CHALK_COLOR; // Use fixed chalk color
            ctx.lineWidth = currentBrushSize;
        }

        function resizeCanvas() {
            const containerSize = canvasContainer.clientWidth; 
            canvas.width = containerSize;
            canvas.height = canvasContainer.clientHeight;
            
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';
            clearCanvas(); 
            // Note: updateCharacterDisplay() is not strictly needed here as it will be called by init/switchLanguage
        }

        function getPos(event) {
            const rect = canvas.getBoundingClientRect();
            let clientX, clientY;
            
            if (event.touches && event.touches.length > 0) {
                clientX = event.touches[0].clientX;
                clientY = event.touches[0].clientY;
            } else {
                clientX = event.clientX;
                clientY = event.clientY;
            }
            
            return {
                x: clientX - rect.left,
                y: clientY - rect.top
            };
        }
        
        function startDrawing(event) {
            event.preventDefault();
            isDrawing = true;
            const { x, y } = getPos(event);
            ctx.beginPath();
            ctx.moveTo(x, y);
            setDrawingStyle(); 
        }

        function draw(event) {
            event.preventDefault();
            if (!isDrawing) return;

            const { x, y } = getPos(event);
            
            if (x < 0 || x > canvas.width || y < 0 || y > canvas.height) {
                stopDrawing(); 
                return;
            }

            ctx.lineTo(x, y);
            ctx.stroke();
            ctx.beginPath(); 
            ctx.moveTo(x, y);
        }

        function stopDrawing() {
            isDrawing = false;
            ctx.closePath();
        }

        // --- Modal Functions ---
        
        /**
         * Finds the index of a character in the current active character list.
         */
        function getCharacterIndex(char) {
            return LANGUAGES[currentLanguage].characters.findIndex(data => data.char === char);
        }

        /**
         * Opens the character selector modal and populates the grid for the specified category.
         */
        function openSelectorModal(categoryId) {
            const categoryData = LANGUAGES[currentLanguage].categories.find(cat => cat.id === categoryId);
            if (!categoryData) return;

            modalTitle.textContent = categoryData.label;
            
            trackEvent('category_open', {
                language: currentLanguage.toLowerCase(),
                category: categoryId
            });

            // Populate the grid
            charGrid.innerHTML = '';
            categoryData.chars.forEach(data => {
                const button = document.createElement('button');
                button.className = 'char-button text-3xl sm:text-4xl font-bold p-2 rounded-lg bg-gray-100 hover:bg-yellow-100 transition shadow-md'; 
                button.textContent = data.char;
                button.dataset.char = data.char;

                button.addEventListener('click', () => {
                    const charIndex = getCharacterIndex(data.char);
                    if (charIndex !== -1) {
                        currentCharacterIndex = charIndex;
                        clearCanvas();
                        updateCharacterDisplay();
                        closeSelectorModal();
                        
                        // Track character selection from modal
                        trackEvent('character_select', {
                            language: currentLanguage.toLowerCase(),
                            character: data.char,
                            category: categoryData.id
                        });
                    }
                });
                charGrid.appendChild(button);
            });

            modal.classList.remove('hidden');
        }

        /**
         * Closes the character selector modal.
         */
        function closeSelectorModal() {
            modal.classList.add('hidden');
        }

        // --- Initialization ---

        function init() {
            // 1. Initial Canvas Resize and Setup (Called first to ensure dimensions are ready)
            resizeCanvas(); 

            // 2. Check for stored language in cookie and set initial language
            const storedLang = getCookie('tracingPadLang');
            const initialLang = (storedLang && LANGUAGES[storedLang]) ? storedLang : 'English';

            // 3. Set the determined initial language (this updates UI/buttons/character)
            // We use a non-existent language 'Initial' just to force the first run of switchLanguage, 
            // since we don't want to skip it if initialLang is 'English'.
            currentLanguage = 'Initial'; 
            switchLanguage(initialLang); 

            // 4. Canvas Drawing Listeners
            canvas.addEventListener('mousedown', startDrawing);
            canvas.addEventListener('touchstart', startDrawing, { passive: false });
            canvas.addEventListener('mousemove', draw);
            canvas.addEventListener('touchmove', draw, { passive: false });
            canvas.addEventListener('mouseout', stopDrawing);
            window.addEventListener('mouseup', stopDrawing); 
            window.addEventListener('touchend', stopDrawing); 
            window.addEventListener('touchcancel', stopDrawing); 

            // 5. Navigation Listeners
            prevBtn.addEventListener('click', () => {
                if (currentCharacterIndex > 0) {
                    currentCharacterIndex--;
                    clearCanvas();
                    updateCharacterDisplay();
                    // Track navigation
                    const currentChar = LANGUAGES[currentLanguage].characters[currentCharacterIndex];
                    trackEvent('character_navigate', {
                        direction: 'previous',
                        language: currentLanguage.toLowerCase(),
                        character: currentChar.char
                    });
                }
            });

            nextBtn.addEventListener('click', () => {
                const charListLength = LANGUAGES[currentLanguage].characters.length;
                if (currentCharacterIndex < charListLength - 1) {
                    currentCharacterIndex++;
                    clearCanvas();
                    updateCharacterDisplay();
                    // Track navigation
                    const currentChar = LANGUAGES[currentLanguage].characters[currentCharacterIndex];
                    trackEvent('character_navigate', {
                        direction: 'next',
                        language: currentLanguage.toLowerCase(),
                        character: currentChar.char
                    });
                }
            });

            // 6. Tool and Link Listeners
            clearBtn.addEventListener('click', clearCanvas);
            
            // External link tracking
            document.getElementById('suggestionsLink').addEventListener('click', () => {
                trackEvent('external_link_click', { link_name: 'suggestions' });
            });

            document.getElementById('buyMeACoffeeLink').addEventListener('click', () => {
                trackEvent('external_link_click', { link_name: 'buy_me_a_coffee' });
            });
            
            // 7. Language Switch Listeners
            // Note: switchLanguage handles saving the cookie
            langBtns.forEach(btn => {
                btn.addEventListener('click', () => switchLanguage(btn.dataset.lang));
            });

            // 8. Modal Listeners
            closeModalBtn.addEventListener('click', closeSelectorModal);
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    closeSelectorModal();
                }
            });
            
            // 9. Global resize listener
            window.addEventListener('resize', resizeCanvas);
        }

        // Initialize the app when the window loads
        window.onload = init;

    </script>
</body>
</html>
